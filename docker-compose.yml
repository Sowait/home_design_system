services:
  mysql:
    build:
      context: .
      dockerfile: docker/mysql.Dockerfile
    image: home-design-mysql:8.0
    environment:
      - MYSQL_ROOT_PASSWORD=12345678
      - MYSQL_DATABASE=home_design
      - TZ=Asia/Shanghai
    command: ["--port=${MYSQL_PORT:-3307}"]
    ports:
      - "${MYSQL_PORT:-3307}:${MYSQL_PORT:-3307}"
    volumes:
      - mysql_data:/var/lib/mysql
    networks:
      - hdnet

  backend:
    build:
      context: .
      dockerfile: docker/backend.Dockerfile
    image: home-design-backend:1.0.0
    environment:
      - SPRING_DATASOURCE_URL=jdbc:mysql://mysql:${MYSQL_PORT:-3307}/home_design?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
      - SPRING_DATASOURCE_USERNAME=root
      - SPRING_DATASOURCE_PASSWORD=12345678
      - TZ=Asia/Shanghai
    depends_on:
      - mysql
    ports:
      - "8080:8080"
    networks:
      - hdnet

  frontend:
    build:
      context: .
      dockerfile: docker/frontend.Dockerfile
    image: home-design-frontend:latest
    depends_on:
      - backend
    ports:
      - "3000:80"
    networks:
      - hdnet

networks:
  hdnet:

volumes:
  mysql_data: